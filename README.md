# **WireGuard VPN: Настройка Клиентской Части для Linux**

Эта инструкция поможет вам установить, настроить, управлять и полностью удалить WireGuard VPN в вашей системе Linux.

Данная инструкция сфокусирована на **настройке WireGuard VPN в качестве клиента**, то есть для подключения вашего устройства к уже существующему WireGuard VPN-серверу. Она предполагает, что у вас уже есть готовый файл конфигурации (`.conf`) от вашего VPN-провайдера или администратора сервера.

-----

## **0. Обновление системы**

Перед началом установки убедитесь, что ваша система обновлена, и у вас есть права суперпользователя (sudo).

**Важное примечание:** Данная инструкция написана для Fedora Linux, которая использует менеджер пакетов `dnf`.

* Если вы используете **Debian, Ubuntu, Mint** или другие дистрибутивы на их основе, замените `sudo dnf install` на `sudo apt install` и `sudo dnf remove` на `sudo apt remove`.
* Для **Arch Linux, Manjaro** используйте `sudo pacman -S` для установки и `sudo pacman -R` для удаления.
* Для **openSUSE** используйте `sudo zypper install` и `sudo zypper remove`.
* Остальные команды (связанные с `nmcli`, `wg-quick`, `systemctl`, `chmod`, `chown`, `mv`, `rm` и т.д.) являются универсальными для большинства современных Linux-дистрибутивов, использующих `systemd` и `NetworkManager`.

```bash
sudo dnf update -y # Для Debian/Ubuntu: sudo apt update -y
sudo dnf upgrade -y # Для Debian/Ubuntu: sudo apt upgrade -y
```

-----

## **1. Установка WireGuard Tools**

Сначала установим необходимые утилиты WireGuard из репозиториев Fedora.

```bash
sudo dnf install wireguard-tools # Для Debian/Ubuntu: sudo apt install wireguard-tools
```

-----

## **2. Настройка Конфигурационного Файла**

Переместите ваш скачанный файл конфигурации (например, `vpntype.conf`) в стандартную директорию WireGuard и переименуйте его в `wg0.conf`. Убедитесь, что `vpntype.conf` находится в вашей папке `~/Downloads/`.

```bash
sudo mv ~/Downloads/vpntype.conf /etc/wireguard/wg0.conf
```

* **Примечание:** Файл `vpntype.conf` вы получаете от вашего VPN-провайдера, администратора сети или генерируете самостоятельно на сервере WireGuard.

-----

## **3. Установка Прав Доступа**

Для **безопасности** критически важно, чтобы ваш файл конфигурации WireGuard (содержащий приватные ключи) был доступен только пользователю `root`.

```bash
sudo chmod 600 /etc/wireguard/wg0.conf
sudo chown root:root /etc/wireguard/wg0.conf
```

-----

## **4. Просмотр Содержимого Конфигурационного Файла (Опционально)**

Вы можете просмотреть содержимое вашего файла `wg0.conf`, чтобы убедиться, что он корректен:

```bash
sudo cat /etc/wireguard/wg0.conf
```

* Будьте осторожны, не делитесь содержимым этого файла, так как он содержит приватные ключи!

-----

## **5. Управление WireGuard через NetworkManager**

**NetworkManager** — это предпочтительный способ управления сетевыми соединениями в Fedora. Он обеспечивает лучшую интеграцию с рабочим столом, более удобное управление и обычно является самым простым методом.

### **5.1. Импорт Конфигурации в NetworkManager**

Эта команда импортирует ваш `wg0.conf` в NetworkManager как новое сетевое соединение.

```bash
sudo nmcli connection import type wireguard file /etc/wireguard/wg0.conf
```

* После импорта NetworkManager обычно создает соединение с именем, соответствующим интерфейсу из вашего `wg0.conf` (например, `wg0`).

### **5.2. Подключение к WireGuard VPN**

Для активации VPN-соединения:

```bash
sudo nmcli connection up wg0
```

* **Важно:** Замените `wg0` на фактическое имя вашего соединения WireGuard, если оно отличается (вы можете проверить имена с помощью `nmcli connection show`).

### **5.3. Проверка Статуса Соединения**

Чтобы убедиться, что VPN-соединение активно:

```bash
nmcli connection show --active
```

* В выводе вы увидите список всех активных сетевых соединений, включая ваше WireGuard-соединение, если оно успешно установлено.
* Вы также можете проверить свой внешний IP-адрес, чтобы убедиться, что трафик идёт через VPN (например, с помощью `curl ifconfig.me` или посетив whoer.net).

### **5.4. Отключение от WireGuard**

Для деактивации VPN-соединения:

```bash
sudo nmcli connection down wg0
```

### **5.5. Отключение Автоматического Подключения**

По умолчанию NetworkManager может настроить VPN на автозапуск при старте системы или подключении к сети. Чтобы отключить это:

```bash
sudo nmcli connection modify wg0 autoconnect no
```

* Чтобы **включить** автозапуск снова: `sudo nmcli connection modify wg0 autoconnect yes`

### **5.6. Редактирование Конфигурации в NetworkManager (Продвинуто)**

Если вам нужно изменить параметры импортированного соединения (например, сменить DNS-сервера или добавить пиры), вы можете сделать это через графический интерфейс GNOME (Настройки -> Сеть) или через nmcli:

```bash
sudo nmcli connection edit wg0
```

* Это откроет интерактивный режим редактирования соединения в терминале.

-----

## **6. Управление WireGuard через `wg-quick` (Альтернативный/Прямой Способ)**

**Важное примечание:** Если вы уже импортировали конфигурацию WireGuard в NetworkManager (см. Раздел 5) и используете её, не рекомендуется одновременно пытаться управлять тем же интерфейсом (`wg0`) через `wg-quick`, так как это может привести к конфликтам. Выберите один из способов управления для данного интерфейса. Этот метод полезен, если вы предпочитаете более низкоуровневый контроль или если NetworkManager вызывает проблемы.

### **6.1. Подключение к WireGuard VPN**

Активируйте интерфейс WireGuard, используя ваш `wg0.conf`:

```bash
sudo wg-quick up wg0
```

### **6.2. Проверка Статуса Соединения**

Для детальной информации о состоянии WireGuard интерфейса:

```bash
wg show wg0
```

### **6.3. Отключение от WireGuard**

Деактивация интерфейса WireGuard:

```bash
sudo wg-quick down wg0
```

### **6.4. Автоматический Запуск При Загрузке (Опционально)**

Чтобы WireGuard запускался автоматически при каждой загрузке системы (управляется `systemd`):

```bash
sudo systemctl enable wg-quick@wg0.service
sudo systemctl start wg-quick@wg0.service
```

### **6.5. Отключение Автоматического Запуска**

Если вы настроили автозапуск `wg-quick@wg0.service` и хотите его отключить:

```bash
# Останавливаем работающую службу WireGuard
sudo systemctl stop wg-quick@wg0.service

# Отключаем службу из автозапуска при загрузке
sudo systemctl disable wg-quick@wg0.service

# Проверяем, что служба отключена из автозапуска
sudo systemctl status wg-quick@wg0.service
```

-----

## **7. Полное Отключение и Удаление WireGuard**

Если вы больше не нуждаетесь в WireGuard VPN и хотите полностью удалить его из системы.

### **7.1. Деактивация и Удаление Соединения NetworkManager (если использовался)**

Сначала убедитесь, что VPN-соединение неактивно, затем удалите его из NetworkManager.

```bash
# Проверяем имя соединения
nmcli connection show --active
nmcli connection show

# Останавливаем соединение, если оно активно
sudo nmcli connection down wg0

# Удаляем соединение из NetworkManager
sudo nmcli connection delete wg0
```

* **Важно:** Замените `wg0` на имя вашего соединения, если оно отличалось.

### **7.2. Удаление Конфигурационного Файла**

Удаление файла `wg0.conf` из системы:

```bash
sudo rm /etc/wireguard/wg0.conf
```

### **7.3. Удаление Инструмента WireGuard**

Наконец, удаляем сам пакет `wireguard-tools` и его зависимости:

```bash
sudo dnf remove wireguard-tools # Для Debian/Ubuntu: sudo apt remove wireguard-tools
```
